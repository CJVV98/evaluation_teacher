{% load static %}
 <div class="container">
    {% csrf_token %}
  </br>

    <div class="row">
        <div class="col-12 d-flex justify-content-end"> 
        <button type="button" class="btn bg-color-prim text-light position-relative dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
            <strong>Ciclo: </strong> <label id="lb_ciclo">2330 </label> <svg width="1em" height="1em" viewBox="0 0 16 16" class="position-absolute top-100 start-50 translate-middle mt-1 bi bi-caret-down-fill" fill="#212529" xmlns="http://www.w3.org/2000/svg">
                <path d="M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/></svg>
        </button> 
        <ul id="list-ciclo" class="dropdown-menu">
            <li><a class="dropdown-item" href="#">2330</a></li>
            <li><a class="dropdown-item" href="#">2310</a></li>
            <li><a class="dropdown-item" href="#">2410</a></li>
        </ul>
    
        </div>
    </div>
</div>
<div class="row" >
    <div class="col-12"> 
      <div class="form-group item-display-none" id="div-search-comments" >
        <input type="text" class="form-control" id="in-search-comments" placeholder="Buscar">
      </div>
      <table class="table item-display-none" id="table-alerts"  data-pagination="true">
        <thead class="text-light">
          <tr>
            <th scope="col">#</th>
            <th scope="col">Nombre del docente</th>
            <th scope="col">Asignatura</th>
            <th scope="col">Criterio</th>
            <th scope="col">Calificaci√≥n</th>
          </tr>
        </thead>
        <tbody>
  
        </tbody>
      </table>
      <nav>
          <ul class="pagination justify-content-end" id="paginator-alerts"></ul>
      </nav>
    </div>
  </div>

  <script>
    var table_alerts =[];
    loadContent();
    $(document).ready(function() {
      console.log("Entrnado aqui")
      $("#in-search-comments").keyup(function() {
          var search = $(this).val().toLowerCase();
          var filtro = table_alerts.filter(function(dato) {
              return dato.name.toLowerCase().includes(search) || dato.course.toLowerCase().includes(search);
          });
          loadTable(filtro, 1, 10); 
          generatePagination(filtro.length, 10, 1);
      });
      $("#list-ciclo li").click(function() {
        var ciclo = $(this).text().trim();
        $("#lb_ciclo").text(ciclo);
        loadContent();

      });
    });
    function loadContent(){
      var ciclo = $("#lb_ciclo").text().trim();
      var csrftoken = getCookie('csrftoken');
      $.ajax({
        url: 'pages/get_list_alerts', 
        type: 'POST',
        data: {
            'ciclo':ciclo
        },
        beforeSend: function(xhr, settings) {
          xhr.setRequestHeader("X-CSRFToken", csrftoken);
        },
        success: function(response) {
              table_alerts=response.list_alerts       
              loadTable(table_alerts,1,10)
              generatePagination(table_alerts.length, 10, 1);
        },
        error: function(xhr, status, error) {
            console.error(error);
        }
     });
    }

    function loadTable(table, pagina, itemsPorPagina) {
      var inicio = (pagina - 1) * itemsPorPagina;
      var fin = inicio + itemsPorPagina;
      var filtro = table.slice(inicio, fin);
      $('#table-alerts tbody').empty();
      $.each(filtro, function(index, row) {
        var row = '<tr><td>' + (index+1) + '</td><td>' + row.name + '</td><td>' + row.course +'</td><td>' + row.criteria +  '</td><td>' + row.prom_criteria + '</td></tr>';
        $('#table-alerts tbody').append(row); 
      });  
      $('#table-alerts thead').removeClass()
      $('#table-alerts').removeClass("item-display-none")
      $('#div-search-comments').removeClass("item-display-none")
      $('#table-alerts thead').addClass("text-light bg-color-prim")
      
      }

    function generatePagination(totalItems, itemsPorPagina, paginaActual) {
        var totalPages = Math.ceil(totalItems / itemsPorPagina);
        $('#paginator-alerts').empty();
        var prevDisabled = (paginaActual === 1) ? "disabled" : "";
        var nextDisabled = (paginaActual === totalPages) ? "disabled" : "";
        var html = '<li class="page-item ' + prevDisabled + '"><a class="page-link color-prim" href="#" data-page="' + (paginaActual - 1) + '">Anterior</a></li>';
        for (var i = 1; i <= totalPages; i++) {
            var active = (paginaActual === i) ? "active" : "";
            var color = active=="active" ? "bg-color-prim" : "color-prim";
            html += '<li class="page-item ' + active + '"><a class="page-link  '+color+ '" href="#" data-page="' + i + '">' + i + '</a></li>';
        }
        html += '<li class="page-item ' + nextDisabled + '"><a class="page-link color-prim" href="#" data-page="' + (paginaActual + 1) + '">Siguiente</a></li>';
        $('#paginator-alerts').html(html);

        $(".page-link").click(function(event) {
            event.preventDefault();
            var pagina = parseInt($(this).data("page"));
            loadTable(table_alerts, pagina, itemsPorPagina);
            generatePagination(table_alerts.length, itemsPorPagina, pagina);
        });
    }

  </script>